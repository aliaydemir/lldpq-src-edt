# LLDPq Docker Compose
# Usage: docker compose up -d
#
# Required: devices.yaml (device inventory)
# Optional: SSH keys (needed for switch monitoring - can also be configured after start)
# Optional: Ansible directory (enables VLAN/BGP reports, Fabric Config/Editor/Deploy)
# Optional: Data directories for persistence

services:
  lldpq:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: lldpq:latest
    container_name: lldpq
    ports:
      - "${LLDPQ_PORT:-80}:80"
    volumes:
      # Required: Device inventory
      - ../lldpq/devices.yaml:/home/lldpq/lldpq/devices.yaml
      
      # Optional: Ansible directory (enables VLAN/BGP reports, Fabric Config/Editor/Deploy)
      # - ~/ansible:/home/lldpq/ansible:rw
      
      # Optional: Topology files (editable from web UI)
      - ../lldpq/topology.dot:/var/www/html/topology.dot
      - ../lldpq/topology_config.yaml:/var/www/html/topology_config.yaml
      
      # Optional: Persistent monitoring data (survives container restart)
      - lldpq-data:/home/lldpq/lldpq/monitor-results
      - lldpq-configs:/var/www/html/configs
      - lldpq-hstr:/var/www/html/hstr
    restart: unless-stopped
    environment:
      - TZ=${TZ:-UTC}
      # Uncomment if mounting Ansible directory:
      # - ANSIBLE_DIR=/home/lldpq/ansible

volumes:
  lldpq-data:
  lldpq-configs:
  lldpq-hstr:
