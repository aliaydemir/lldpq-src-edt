# LLDPq Docker Compose
# Usage: docker compose up -d
#
# Required: devices.yaml (device inventory)
# Optional: SSH keys (mount for persistent key-based auth to switches)
# Optional: Ansible directory (enables VLAN/BGP reports, Fabric Config/Editor/Deploy)
# Optional: Data directories for persistence

services:
  lldpq:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: lldpq:latest
    container_name: lldpq
    ports:
      - "${LLDPQ_PORT:-80}:80"
    volumes:
      # Required: Device inventory
      - ../lldpq/devices.yaml:/home/lldpq/lldpq/devices.yaml

      # SSH keys: mount host keys as read-only, entrypoint copies to writable .ssh
      # This ensures keys survive container recreation
      - ssh-keys:/home/lldpq/.ssh
      
      # Optional: Ansible directory (enables VLAN/BGP reports, Fabric Config/Editor/Deploy)
      # - ~/ansible:/home/lldpq/ansible:rw
      
      # Optional: Topology files (editable from web UI)
      - ../lldpq/topology.dot:/var/www/html/topology.dot
      - ../lldpq/topology_config.yaml:/var/www/html/topology_config.yaml
      
      # Persistent monitoring data (survives container restart/recreation)
      - lldpq-data:/home/lldpq/lldpq/monitor-results
      - lldpq-configs:/var/www/html/configs
      - lldpq-hstr:/var/www/html/hstr
    restart: unless-stopped
    environment:
      - TZ=${TZ:-UTC}
      # Uncomment if mounting Ansible directory:
      # - ANSIBLE_DIR=/home/lldpq/ansible

volumes:
  ssh-keys:        # SSH keys persist across container recreation
  lldpq-data:      # Monitoring results
  lldpq-configs:   # Device configurations
  lldpq-hstr:      # Historical data
