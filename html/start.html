<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>..::LLDPQ::..</title>
    <link rel="shortcut icon" href="/png/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/styles2.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        
        .analysis-section {
            margin: 30px 0;
            background: #2d2d2d;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #444;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #b57614;
            margin: 0;
            background: rgba(181, 118, 20, 0.1);
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid rgba(181, 118, 20, 0.3);
            display: inline-block;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .section-title:hover {
            background: rgba(181, 118, 20, 0.2);
            border-color: rgba(181, 118, 20, 0.5);
            transform: translateY(-1px);
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #007bff;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .card-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        /* Card Border Colors */
        .card-total { border-left-color: #2196f3; }
        .card-excellent { border-left-color: #4caf50; }
        .card-good { border-left-color: #8bc34a; }
        .card-warning { border-left-color: #ff9800; }
        .card-critical { border-left-color: #f44336; }
        .card-info { border-left-color: #17a2b8; }
        
        /* Status Colors */
        .status-excellent { color: #4caf50; }
        .status-good { color: #8bc34a; }
        .status-warning { color: #ff9800; }
        .status-critical { color: #f44336; }
        .status-info { color: #17a2b8; }
        
        .main-title {
            font-size: 3.2em;
            font-weight: bold;
            color: #b57614;
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(181, 118, 20, 0.3);
        }
        
        .last-updated {
            text-align: center;
            margin: 20px 0;
            color: #ccc;
            font-size: 16px;
        }
        
        .nvidia-logo {
            text-align: center;
            margin: 10px 0 20px 0;
        }
        
        .nvidia-logo img {
            max-width: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .dashboard-stats {
            background: linear-gradient(135deg, #3d3d3d 0%, #4a4a4a 100%);
            border: 1px solid #b57614;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            color: #e0e0e0;
            box-shadow: 0 4px 8px rgba(181, 118, 20, 0.2);
        }
        
        .dashboard-stats h3 {
            margin: 0 0 15px 0;
            font-size: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(181, 118, 20, 0.1);
            border: 1px solid rgba(181, 118, 20, 0.3);
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(181, 118, 20, 0.2);
            border-color: rgba(181, 118, 20, 0.5);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1 class="main-title">LLDPQ</h1>
        
        <div class="nvidia-logo">
            <img src="/png/nvidia-logo.jpg" alt="NVIDIA Logo">
        </div>
        
        <div class="last-updated">
            <strong>Last Updated:</strong> <span id="last-updated-time"></span>
        </div>
        
        <!-- Dashboard Overview Stats -->
        <div class="dashboard-stats">
            <h3>Network Health Overview</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="total-network-devices">--</div>
                    <div class="stat-label">Total Network Devices</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-interfaces">--</div>
                    <div class="stat-label">Total Interfaces</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="overall-health">--</div>
                    <div class="stat-label">Overall Health</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="critical-issues">--</div>
                    <div class="stat-label">Critical Issues</div>
                </div>
            </div>
        </div>

        <!-- Hardware Health Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='/monitor-results/hardware-analysis.html'">Hardware Health Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='/monitor-results/hardware-analysis.html'">
                    <div class="card-value" id="hardware-total">--</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='/monitor-results/hardware-analysis.html'">
                    <div class="card-value status-excellent" id="hardware-excellent">--</div>
                    <div class="card-label">Excellent</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='/monitor-results/hardware-analysis.html'">
                    <div class="card-value status-good" id="hardware-good">--</div>
                    <div class="card-label">Good</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='/monitor-results/hardware-analysis.html'">
                    <div class="card-value status-warning" id="hardware-warnings">--</div>
                    <div class="card-label">Warnings</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='/monitor-results/hardware-analysis.html'">
                    <div class="card-value status-critical" id="hardware-critical">--</div>
                    <div class="card-label">Critical</div>
                </div>
            </div>
        </div>

        <!-- Log Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='/monitor-results/log-analysis.html'">Log Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='/monitor-results/log-analysis.html'">
                    <div class="card-value" id="log-devices">--</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='/monitor-results/log-analysis.html'">
                    <div class="card-value status-critical" id="log-critical">--</div>
                    <div class="card-label">Critical</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='/monitor-results/log-analysis.html'">
                    <div class="card-value status-warning" id="log-warnings">--</div>
                    <div class="card-label">Warnings</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='/monitor-results/log-analysis.html'">
                    <div class="card-value status-info" id="log-errors">--</div>
                    <div class="card-label">Errors</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='/monitor-results/log-analysis.html'">
                    <div class="card-value status-good" id="log-info">--</div>
                    <div class="card-label">Info Messages</div>
                </div>
            </div>
        </div>

        <!-- Assets Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='assets.html'">Asset Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='assets.html'">
                    <div class="card-value" id="assets-total">16</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='assets.html'">
                    <div class="card-value status-excellent" id="assets-success">16</div>
                    <div class="card-label">Successful</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='assets.html'">
                    <div class="card-value status-critical" id="assets-failed">0</div>
                    <div class="card-label">Failed</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='assets.html'">
                    <div class="card-value status-warning" id="assets-warnings">0</div>
                    <div class="card-label">Warnings</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='assets.html'">
                    <div class="card-value status-info" id="assets-no-info">0</div>
                    <div class="card-label">No Information</div>
                </div>
            </div>
        </div>

        <!-- LLDP Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='lldp.html'">LLDP Topology Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='lldp.html'">
                    <div class="card-value" id="lldp-total">78</div>
                    <div class="card-label">Total Connections</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-excellent" id="lldp-success">72</div>
                    <div class="card-label">Successful Links</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-critical" id="lldp-failed">2</div>
                    <div class="card-label">Failed Links</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-warning" id="lldp-warning">3</div>
                    <div class="card-label">Warning Links</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='lldp.html'">
                    <div class="card-value status-info" id="lldp-no-info">1</div>
                    <div class="card-label">No Info Links</div>
                </div>
            </div>
        </div>

        <!-- BGP Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/bgp-analysis.html'">BGP Neighbor Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-devices">0</div>
                    <div class="card-label">BGP Devices</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-neighbors">0</div>
                    <div class="card-label">Total Neighbors</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value status-excellent" id="bgp-established">0</div>
                    <div class="card-label">Established</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value status-critical" id="bgp-down">0</div>
                    <div class="card-label">Down/Problem</div>
                </div>
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/bgp-analysis.html'">
                    <div class="card-value" id="bgp-health">0.0%</div>
                    <div class="card-label">Health Ratio</div>
                </div>
            </div>
        </div>

        <!-- Link Flap Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/link-flap-analysis.html'">Link Flap Detection</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-devices">1</div>
                    <div class="card-label">Total Devices</div>
                </div>
                <div class="summary-card card-info" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-ports">4</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value status-excellent" id="flap-stable">4</div>
                    <div class="card-label">Stable</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value status-critical" id="flap-problematic">0</div>
                    <div class="card-label">Problematic</div>
                </div>
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/link-flap-analysis.html'">
                    <div class="card-value" id="flap-stability">100.0%</div>
                    <div class="card-label">Stability Ratio</div>
                </div>
            </div>
        </div>

        <!-- Optical Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/optical-analysis.html'">Optical Diagnostics Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value" id="optical-total">944</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-excellent" id="optical-excellent">725</div>
                    <div class="card-label">Excellent</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-good" id="optical-good">32</div>
                    <div class="card-label">Good</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-warning" id="optical-warning">0</div>
                    <div class="card-label">Warning</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/optical-analysis.html'">
                    <div class="card-value status-critical" id="optical-critical">187</div>
                    <div class="card-label">Critical</div>
                </div>
            </div>
        </div>

        <!-- BER Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <h2 class="section-title" onclick="window.location.href='monitor-results/ber-analysis.html'">BER Analysis</h2>
            </div>
            <div class="summary-grid">
                <div class="summary-card card-total" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value" id="ber-total">0</div>
                    <div class="card-label">Total Ports</div>
                </div>
                <div class="summary-card card-excellent" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-excellent" id="ber-excellent">0</div>
                    <div class="card-label">Excellent</div>
                </div>
                <div class="summary-card card-good" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-good" id="ber-good">0</div>
                    <div class="card-label">Good</div>
                </div>
                <div class="summary-card card-warning" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-warning" id="ber-warning">0</div>
                    <div class="card-label">Warning</div>
                </div>
                <div class="summary-card card-critical" onclick="window.location.href='monitor-results/ber-analysis.html'">
                    <div class="card-value status-critical" id="ber-critical">0</div>
                    <div class="card-label">Critical</div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Set last updated time
        function setLastUpdated() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const formattedDate = now.toLocaleString('en-US', options);
            document.getElementById('last-updated-time').textContent = formattedDate;
        }

        // Fetch summary data directly from data files
        async function fetchRawDataSummary(dataType) {
            try {
                let summaryData = {};
                
                if (dataType === 'assets') {
                    // Parse assets.ini file with same logic as assets.html
                    const assetsResponse = await fetch('assets.ini');
                    const assetsText = await assetsResponse.text();
                    const assetsLines = assetsText.split('\n').filter(line => 
                        line.trim() && 
                        !line.startsWith('DEVICE-NAME') && 
                        !line.startsWith('Created on')
                    );
                    
                    summaryData.totalDevices = assetsLines.length;
                    summaryData.successful = 0;
                    summaryData.failed = 0;
                    summaryData.warning = 0;
                    summaryData.noInfo = 0;
                    
                    // Parse each line using same logic as assets.html
                    assetsLines.forEach(line => {
                        if (!line.trim()) return;
                        
                        const parts = line.trim().split(/\s+/);
                        if (parts.length < 6) return;
                        
                        const deviceName = parts[0];
                        const ipAddress = parts[1];
                        const macAddress = parts[2];
                        const serialNumber = parts[3];
                        const model = parts[4];
                        const release = parts[5];
                        const uptime = parts.slice(6).join(' ');
                        
                        // Use exact same status determination logic as assets.html
                        const lineText = line.toLowerCase();
                        
                        if (lineText.includes('ssh-failed') || (ipAddress && ipAddress !== 'No-Info' && macAddress === 'SSH-FAILED')) {
                            summaryData.failed++;
                        } else if (lineText.includes('fail') || lineText.includes('error') || lineText.includes('timeout')) {
                            summaryData.failed++;
                        } else if (lineText.includes('no-info') || lineText.includes('no info') || 
                                   (!ipAddress || ipAddress === 'N/A' || !macAddress || macAddress === 'N/A')) {
                            summaryData.noInfo++;
                        } else if (lineText.includes('reated') || lineText.includes('partial') || lineText.includes('warning')) {
                            summaryData.warning++;
                        } else if (uptime && uptime.includes('up-') && ipAddress && macAddress && 
                                   ipAddress !== 'N/A' && macAddress !== 'N/A') {
                            summaryData.successful++;
                        } else {
                            summaryData.warning++;
                        }
                    });
                    
                } else if (dataType === 'lldp') {
                    // Parse lldp_results.ini directly (structured text format)
                    const response = await fetch('lldp_results.ini');
                    const text = await response.text();
                    const lines = text.split('\n');
                    
                    summaryData.totalConnections = 0;
                    summaryData.successful = 0;
                    summaryData.failed = 0;
                    summaryData.warning = 0;
                    summaryData.noInfo = 0;
                    
                    lines.forEach(line => {
                        // Look for port status lines (swp + Pass/Fail/No-Info pattern)
                        if (line.includes('swp') && (line.includes('Pass') || line.includes('Fail') || line.includes('No-Info'))) {
                            const parts = line.trim().split(/\s+/);
                            if (parts.length >= 2) {
                                const status = parts[1]; // Status is second column
                                summaryData.totalConnections++;
                                
                                if (status === 'Pass') summaryData.successful++;
                                else if (status === 'Fail') summaryData.failed++;
                                else if (status === 'No-Info') summaryData.noInfo++;
                            }
                        }
                    });
                    
                    // LLDP data parsed
                    
                } else if (dataType === 'optical') {
                    // Special case for optical: use summary cards because they have correct total ports count
                    const response = await fetch('monitor-results/optical-analysis.html');
                    
                    if (!response.ok) {
                        return summaryData;
                    }
                    
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Parse summary cards for optical (they have the correct total ports count)
                    const totalPortsElement = doc.querySelector('#total-ports');
                    const excellentElement = doc.querySelector('#excellent-ports');
                    const goodElement = doc.querySelector('#good-ports');
                    const warningElement = doc.querySelector('#warning-ports');
                    const criticalElement = doc.querySelector('#critical-ports');
                    
                    summaryData.totalPorts = totalPortsElement ? parseInt(totalPortsElement.textContent) : 0;
                    summaryData.excellent = excellentElement ? parseInt(excellentElement.textContent) : 0;
                    summaryData.good = goodElement ? parseInt(goodElement.textContent) : 0;
                    summaryData.warning = warningElement ? parseInt(warningElement.textContent) : 0;
                    summaryData.critical = criticalElement ? parseInt(criticalElement.textContent) : 0;
                    
                    // Count unique devices from table for optical (if needed)
                    const rows = doc.querySelectorAll('tbody tr[data-health]');
                    summaryData.totalDevices = new Set(Array.from(rows).map(row => row.cells[0]?.textContent.trim())).size;
                    
                } else if (dataType === 'hardware') {
                    // Parse hardware-analysis.html summary cards
                    const response = await fetch('monitor-results/hardware-analysis.html');
                    
                    if (!response.ok) {
                        return summaryData;
                    }
                    
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Parse summary cards for hardware
                    const totalDevicesElement = doc.querySelector('#total-devices');
                    const excellentElement = doc.querySelector('#excellent-devices');
                    const goodElement = doc.querySelector('#good-devices');
                    const warningElement = doc.querySelector('#warning-devices');
                    const criticalElement = doc.querySelector('#critical-devices');
                    
                    summaryData.totalDevices = totalDevicesElement ? parseInt(totalDevicesElement.textContent) : 0;
                    summaryData.excellent = excellentElement ? parseInt(excellentElement.textContent) : 0;
                    summaryData.good = goodElement ? parseInt(goodElement.textContent) : 0;
                    summaryData.warning = warningElement ? parseInt(warningElement.textContent) : 0;
                    summaryData.critical = criticalElement ? parseInt(criticalElement.textContent) : 0;
                    
                } else if (dataType === 'log') {
                    // Parse log summary data from log_summary.json
                    try {
                        const response = await fetch('monitor-results/log_summary.json');
                        
                        if (!response.ok) {
                            // Return default values if log summary doesn't exist yet
                            return {
                                totalDevices: 0,
                                critical: 0,
                                warning: 0,
                                error: 0,
                                info: 0
                            };
                        }
                        
                        const logSummaryData = await response.json();
                        
                        summaryData.totalDevices = logSummaryData.total_devices || 0;
                        summaryData.critical = logSummaryData.totals?.critical || 0;
                        summaryData.warning = logSummaryData.totals?.warning || 0;
                        summaryData.error = logSummaryData.totals?.error || 0;
                        summaryData.info = logSummaryData.totals?.info || 0;
                        
                    } catch (error) {
                        console.warn('Failed to fetch log summary data:', error);
                        // Return default values
                        summaryData = {
                            totalDevices: 0,
                            critical: 0,
                            warning: 0,
                            error: 0,
                            info: 0
                        };
                    }
                    
                } else {
                    // For other analysis pages (BGP, BER, Link Flap), parse table data
                    const pageMap = {
                        'bgp': 'monitor-results/bgp-analysis.html',
                        'ber': 'monitor-results/ber-analysis.html',
                        'flap': 'monitor-results/link-flap-analysis.html'
                    };
                    
                    const pageUrl = pageMap[dataType];
                    if (pageUrl) {
                        const response = await fetch(pageUrl);
                        
                        if (!response.ok) {
                            return summaryData;
                        }
                        
                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        // Parse table rows instead of summary cards
                        const rows = doc.querySelectorAll('tbody tr[data-health], tbody tr[data-status], tbody tr[data-state]');
                        
                        summaryData.totalPorts = rows.length;
                        summaryData.totalDevices = new Set(Array.from(rows).map(row => row.cells[0]?.textContent.trim())).size;
                        summaryData.totalNeighbors = rows.length; // BGP neighbors = rows
                        summaryData.excellent = 0;
                        summaryData.good = 0;
                        summaryData.warning = 0;
                        summaryData.critical = 0;
                        summaryData.established = 0;
                        summaryData.failed = 0;
                        summaryData.stable = 0;
                        summaryData.problematic = 0;
                        
                        rows.forEach(row => {
                            const health = row.getAttribute('data-health') || '';
                            const status = row.getAttribute('data-status') || '';
                            const state = row.getAttribute('data-state') || '';
                            
                            // Count by health/status
                            if (health === 'excellent' || status === 'excellent') summaryData.excellent++;
                            else if (health === 'good' || status === 'good') summaryData.good++;
                            else if (health === 'warning' || status === 'warning') summaryData.warning++;
                            else if (health === 'critical' || status === 'critical') summaryData.critical++;
                            
                            // Count by state (BGP)
                            if (state === 'established') summaryData.established++;
                            else if (state === 'idle' || state === 'active' || state === 'connect' || state === 'down') summaryData.failed++;
                            
                            // Count by stability (Link Flap uses 'ok' not 'stable')
                            if (status === 'stable' || status === 'ok') summaryData.stable++;
                            else if (status === 'problematic' || status === 'flapped') summaryData.problematic++;
                        });
                        
                        // Calculate percentages based on data type
                        if (dataType === 'bgp' && summaryData.totalNeighbors > 0) {
                            summaryData.healthPercent = ((summaryData.established / summaryData.totalNeighbors) * 100).toFixed(1);
                        }
                        
                        if (dataType === 'flap' && summaryData.totalPorts > 0) {
                            summaryData.stabilityPercent = ((summaryData.stable / summaryData.totalPorts) * 100).toFixed(1);
                        }
                        
                        // Analysis data parsed from table
                    }
                }
                
                return summaryData;
                
            } catch (error) {
                console.warn(`Failed to fetch ${dataType} data:`, error);
                return {};
            }
        }

        // Calculate overall network stats with real-time data
        async function updateNetworkStats() {
            try {
                // Fetch data directly from raw data files
                const [assetsData, lldpData, bgpData, opticalData, berData, flapData, hardwareData, logData] = await Promise.all([
                    fetchRawDataSummary('assets'),
                    fetchRawDataSummary('lldp'), 
                    fetchRawDataSummary('bgp'),
                    fetchRawDataSummary('optical'),
                    fetchRawDataSummary('ber'),
                    fetchRawDataSummary('flap'),
                    fetchRawDataSummary('hardware'),
                    fetchRawDataSummary('log')
                ]);
                
                // Data fetched successfully

                // Update dashboard summary cards
                updateDashboardCard('assets-total', assetsData.totalDevices);
                updateDashboardCard('assets-success', assetsData.successful);
                updateDashboardCard('assets-warning', assetsData.warning);
                updateDashboardCard('assets-failed', assetsData.failed);
                updateDashboardCard('assets-no-info', assetsData.noInfo);

                updateDashboardCard('lldp-total', lldpData.totalConnections);
                updateDashboardCard('lldp-success', lldpData.successful);
                updateDashboardCard('lldp-failed', lldpData.failed);
                updateDashboardCard('lldp-warning', lldpData.warning);
                updateDashboardCard('lldp-no-info', lldpData.noInfo);

                updateDashboardCard('bgp-devices', bgpData.totalDevices);
                updateDashboardCard('bgp-neighbors', bgpData.totalNeighbors);
                updateDashboardCard('bgp-established', bgpData.established);
                updateDashboardCard('bgp-down', bgpData.failed);
                updateDashboardCard('bgp-health', bgpData.healthPercent ? bgpData.healthPercent + '%' : '0.0%');

                updateDashboardCard('optical-total', opticalData.totalPorts);
                updateDashboardCard('optical-excellent', opticalData.excellent);
                updateDashboardCard('optical-good', opticalData.good);
                updateDashboardCard('optical-warning', opticalData.warning);
                updateDashboardCard('optical-critical', opticalData.critical);

                updateDashboardCard('ber-total', berData.totalPorts);
                updateDashboardCard('ber-excellent', berData.excellent);
                updateDashboardCard('ber-good', berData.good);
                updateDashboardCard('ber-warning', berData.warning);
                updateDashboardCard('ber-critical', berData.critical);

                updateDashboardCard('flap-devices', flapData.totalDevices);
                updateDashboardCard('flap-ports', flapData.totalPorts);
                updateDashboardCard('flap-stable', flapData.stable);
                updateDashboardCard('flap-problematic', flapData.problematic);
                updateDashboardCard('flap-stability', flapData.stabilityPercent ? flapData.stabilityPercent + '%' : '0.0%');

                updateDashboardCard('hardware-total', hardwareData.totalDevices);
                updateDashboardCard('hardware-excellent', hardwareData.excellent);
                updateDashboardCard('hardware-good', hardwareData.good);
                updateDashboardCard('hardware-warnings', hardwareData.warning);
                updateDashboardCard('hardware-critical', hardwareData.critical);

                updateDashboardCard('log-devices', logData.totalDevices);
                updateDashboardCard('log-critical', logData.critical);
                updateDashboardCard('log-warnings', logData.warning);
                updateDashboardCard('log-errors', logData.error);
                updateDashboardCard('log-info', logData.info);

                // Calculate overall network statistics
                const totalDevices = assetsData.totalDevices || 0;
                const totalInterfaces = Math.max(opticalData.totalPorts || 0, berData.totalPorts || 0);
                
            const criticalIssues = 
                    (assetsData.failed || 0) +
                    (lldpData.failed || 0) +
                    (lldpData.noInfo || 0) +
                    (bgpData.failed || 0) +
                    (opticalData.critical || 0) +
                    (berData.critical || 0) +
                    (flapData.problematic || 0) +
                    (hardwareData.critical || 0) +
                    (hardwareData.warning || 0) +
                    (logData.critical || 0) +
                    (logData.warning || 0);
                
                const healthyItems = 
                    (assetsData.successful || 0) +
                    (lldpData.successful || 0) +
                    (opticalData.excellent || 0) +
                    (flapData.stable || 0) +
                    (hardwareData.excellent || 0) +
                    (hardwareData.good || 0) +
                    (logData.info || 0);
                
                const totalAssessments = 
                    totalDevices + 
                    (lldpData.totalConnections || 0) + 
                    (opticalData.totalPorts || 0) + 
                    (flapData.totalPorts || 0) +
                    (hardwareData.totalDevices || 0) +
                    ((logData.critical || 0) + (logData.warning || 0) + (logData.info || 0));
                
            const overallHealth = totalAssessments > 0 ? Math.round((healthyItems / totalAssessments) * 100) : 0;
            
            // Update dashboard stats
            document.getElementById('total-network-devices').textContent = totalDevices;
            document.getElementById('total-interfaces').textContent = totalInterfaces;
            document.getElementById('overall-health').textContent = overallHealth + '%';
            document.getElementById('critical-issues').textContent = criticalIssues;
            
            // Color code the health percentage
            const healthElement = document.getElementById('overall-health');
            if (overallHealth >= 95) {
                healthElement.style.color = '#4caf50';
            } else if (overallHealth >= 85) {
                healthElement.style.color = '#8bc34a';
            } else if (overallHealth >= 70) {
                healthElement.style.color = '#ff9800';
            } else {
                healthElement.style.color = '#f44336';
            }
            
            // Color code critical issues
            const criticalElement = document.getElementById('critical-issues');
            if (criticalIssues === 0) {
                criticalElement.style.color = '#4caf50';
            } else if (criticalIssues <= 5) {
                criticalElement.style.color = '#ff9800';
            } else {
                criticalElement.style.color = '#f44336';
                }
                
            } catch (error) {
                console.error('Failed to update network stats:', error);
            }
        }

        // Helper function to update dashboard card values
        function updateDashboardCard(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value !== undefined && value !== null ? value : 0;
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            setLastUpdated();
            updateNetworkStats();
            
            // Update every 2 minutes (large data files)
            setInterval(function() {
                setLastUpdated();
                updateNetworkStats();
            }, 120000);
        });

        // Add hover effects for clickable cards
        document.querySelectorAll('.summary-card[onclick]').forEach(card => {
            card.style.cursor = 'pointer';
        });
    </script>
</body>
</html>