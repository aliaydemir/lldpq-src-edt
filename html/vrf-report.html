<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="/png/favicon.ico">
    <title>..::LLDPQ::..</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="css/auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #404040;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #76b900;
        }
        
        .last-updated {
            font-size: 13px;
            color: #888;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* Summary Cards Grid */
        .summary-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        
        .summary-card { 
            background: #252526; 
            padding: 15px; 
            border-radius: 6px; 
            border-left: 3px solid #76b900;
            transition: all 0.2s ease;
        }
        
        .card-total { border-left-color: #76b900; }
        .card-info { border-left-color: #4fc3f7; }
        .card-warning { border-left-color: #ff9800; }
        .card-purple { border-left-color: #9c27b0; }
        
        .card-value { 
            font-size: 28px; 
            font-weight: bold; 
            color: #fff; 
        }
        
        .card-total .card-value { color: #76b900; }
        .card-info .card-value { color: #4fc3f7; }
        .card-warning .card-value { color: #ffb74d; }
        .card-purple .card-value { color: #ce93d8; }
        
        .card-label { 
            font-size: 12px; 
            color: #888; 
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-tooltip {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border: 1px solid #404040;
            border-radius: 6px;
            padding: 10px;
            margin-top: 5px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        
        .summary-card:hover .card-tooltip {
            display: block;
        }
        
        .card-tooltip ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .card-tooltip li {
            padding: 4px 0;
            font-size: 12px;
            color: #ccc;
            border-bottom: 1px solid #333;
        }
        
        .card-tooltip li:last-child {
            border-bottom: none;
        }
        
        /* Dashboard Section */
        .dashboard-section {
            background: #2d2d2d;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .section-header {
            padding: 12px 16px;
            background: #333;
            font-weight: 600;
            font-size: 14px;
            color: #76b900;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #404040;
        }
        
        .section-content {
            padding: 0;
        }
        
        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            text-align: left;
            padding: 12px 14px;
            background: #252526;
            color: #888;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #404040;
        }
        
        .data-table td {
            padding: 10px 14px;
            border-bottom: 1px solid #333;
            font-size: 13px;
        }
        
        .data-table tr:hover {
            background: #333;
        }
        
        .data-table tr.expandable {
            cursor: pointer;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .badge-green { background: rgba(118, 185, 0, 0.2); color: #76b900; }
        .badge-blue { background: rgba(33, 150, 243, 0.2); color: #64b5f6; }
        .badge-purple { background: rgba(156, 39, 176, 0.2); color: #ce93d8; }
        .badge-orange { background: rgba(255, 152, 0, 0.2); color: #ffb74d; }
        .badge-gray { background: rgba(158, 158, 158, 0.2); color: #9e9e9e; }
        .badge-cyan { background: rgba(0, 188, 212, 0.2); color: #4dd0e1; }
        .badge-pink { background: rgba(233, 30, 99, 0.2); color: #f48fb1; }
        
        /* Action buttons in table */
        .row-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-icon {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .btn-icon-edit {
            background: rgba(33, 150, 243, 0.2);
            color: #64b5f6;
        }
        
        .btn-icon-edit:hover {
            background: #2196f3;
            color: white;
        }
        
        .btn-icon-delete {
            background: rgba(244, 67, 54, 0.2);
            color: #ef5350;
        }
        
        .btn-icon-delete:hover {
            background: #f44336;
            color: white;
        }
        
        /* Expand icon */
        .expand-icon {
            display: inline-block;
            width: 20px;
            color: #666;
            transition: transform 0.2s;
        }
        
        .expand-icon.rotated {
            transform: rotate(90deg);
        }
        
        /* Device list row */
        .device-list-row {
            display: none;
            background: #252526;
        }
        
        .device-list-row.visible {
            display: table-row;
        }
        
        .device-list-row td {
            padding: 15px 14px 15px 50px;
        }
        
        .device-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .device-chip {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .device-chip .remove-btn {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 0 2px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .device-chip .remove-btn:hover {
            opacity: 1;
        }
        
        .device-chip {
            background: #333;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #76b900;
        }
        
        /* VRF Name */
        .vrf-name {
            color: #ce93d8;
            font-weight: 500;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #76b900;
            color: white;
        }
        
        .btn-primary:hover {
            background: #8ed100;
        }
        
        .btn-secondary {
            background: #444;
            color: #ccc;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #333;
            border-top-color: #76b900;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.visible {
            display: flex;
        }
        
        .modal-content {
            background: #2d2d2d;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: auto;
        }
        
        .modal-header {
            padding: 15px 20px;
            background: #76b900;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .modal-header h3 {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: rgba(255,255,255,0.8);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #fff;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background: #252526;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Form styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #888;
            font-size: 12px;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px 12px;
            background: #1e1e1e;
            border: 1px solid #404040;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #76b900;
        }
        
        .form-hint {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
        
        /* No data message */
        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
        }
    </style>
</head>
<body>
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <div class="page-title">VRF Report</div>
            <div class="last-updated" id="last-updated">Loading...</div>
        </div>
        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="loadData()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                Refresh
            </button>
        </div>
    </div>
    
    <!-- Summary Cards -->
    <div class="summary-grid">
        <div class="summary-card card-total">
            <div class="card-value" id="total-vrfs">-</div>
            <div class="card-label">Total VRFs</div>
        </div>
        <div class="summary-card card-info">
            <div class="card-value" id="total-devices">-</div>
            <div class="card-label">Devices with VRFs</div>
        </div>
        <div class="summary-card card-warning" id="infra-card" style="cursor: pointer; position: relative;">
            <div class="card-value" id="infra-vrfs">-</div>
            <div class="card-label">Infra VRFs</div>
            <div class="card-tooltip" id="infra-tooltip"></div>
        </div>
        <div class="summary-card card-purple" id="tenant-card" style="cursor: pointer; position: relative;">
            <div class="card-value" id="tenant-vrfs">-</div>
            <div class="card-label">Tenant VRFs</div>
            <div class="card-tooltip" id="tenant-tooltip"></div>
        </div>
    </div>
    
    <!-- VRF Table Section -->
    <div class="dashboard-section">
        <div class="section-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
            </svg>
            VRF Profiles
            <button class="btn btn-primary" onclick="openCreateVrfModal()" style="margin-left: auto;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Create
            </button>
        </div>
        <div class="section-content" id="content-area">
            <div class="loading">
                <div class="spinner"></div>
                Loading VRF data...
            </div>
        </div>
    </div>
    
    <!-- BGP Profiles Section -->
    <div class="dashboard-section" style="margin-top: 30px;">
        <div class="section-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            BGP Profiles
            <button class="btn btn-primary" onclick="openCreateBgpProfileModal()" style="margin-left: auto;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Create
            </button>
        </div>
        <div class="section-content" id="bgp-profiles-content">
            <div class="loading">
                <div class="spinner"></div>
                Loading BGP profiles...
            </div>
        </div>
    </div>
    
    <!-- Create BGP Profile Modal -->
    <div class="modal" id="create-bgp-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Create BGP Profile</h3>
                <button class="modal-close" onclick="closeCreateBgpProfileModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="create-bgp-form">
                    <div class="form-group">
                        <label>Profile Name *</label>
                        <input type="text" id="bgp-profile-name" placeholder="e.g., OVERLAY_LEAF" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="bgp-redistribute-connected" checked style="width: 16px; height: 16px;">
                                Redistribute Connected
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="bgp-redistribute-static" style="width: 16px; height: 16px;">
                                Redistribute Static
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="bgp-export-evpn-type5" style="width: 16px; height: 16px;">
                                Export to EVPN Type-5
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="bgp-enable-evpn" style="width: 16px; height: 16px;">
                                Enable L2VPN EVPN
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Peer Groups</label>
                        <div id="bgp-peer-groups-container">
                            <div class="peer-group-entry" style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                                    <input type="text" class="pg-name" placeholder="Peer Group Name" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                                    <select class="pg-type" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                                        <option value="external">External</option>
                                        <option value="internal">Internal</option>
                                    </select>
                                    <button type="button" onclick="this.closest('.peer-group-entry').remove()" style="background: #c53030; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">×</button>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                                        <input type="checkbox" class="pg-bfd" checked style="width: 14px; height: 14px;">
                                        Enable BFD
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                                        <input type="checkbox" class="pg-evpn" style="width: 14px; height: 14px;">
                                        Enable EVPN
                                    </label>
                                </div>
                                <input type="text" class="pg-description" placeholder="Description (optional)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; margin-bottom: 10px;">
                                <textarea class="pg-peers" placeholder="Peers (one per line: swp1, swp2 or 10.0.0.1, 10.0.0.2)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; min-height: 60px; font-family: monospace;"></textarea>
                            </div>
                        </div>
                        <button type="button" onclick="addPeerGroupEntry('bgp-peer-groups-container')" style="background: #404040; color: #ccc; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px;">
                            + Add Peer Group
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreateBgpProfileModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createBgpProfile()">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Edit BGP Profile Modal -->
    <div class="modal" id="edit-bgp-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Edit BGP Profile</h3>
                <button class="modal-close" onclick="closeEditBgpProfileModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="edit-bgp-form">
                    <input type="hidden" id="edit-bgp-original-name">
                    <div class="form-group">
                        <label>Profile Name *</label>
                        <input type="text" id="edit-bgp-profile-name" placeholder="e.g., OVERLAY_LEAF" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="edit-bgp-redistribute-connected" style="width: 16px; height: 16px;">
                                Redistribute Connected
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="edit-bgp-redistribute-static" style="width: 16px; height: 16px;">
                                Redistribute Static
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="edit-bgp-export-evpn-type5" style="width: 16px; height: 16px;">
                                Export to EVPN Type-5
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="edit-bgp-enable-evpn" style="width: 16px; height: 16px;">
                                Enable L2VPN EVPN
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Peer Groups</label>
                        <div id="edit-bgp-peer-groups-container"></div>
                        <button type="button" onclick="addPeerGroupEntry('edit-bgp-peer-groups-container')" style="background: #404040; color: #ccc; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px;">
                            + Add Peer Group
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditBgpProfileModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveBgpProfile()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Delete BGP Profile Modal -->
    <div class="modal" id="delete-bgp-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header" style="background: #c53030;">
                <h3>Delete BGP Profile</h3>
                <button class="modal-close" onclick="closeDeleteBgpProfileModal()">×</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p style="color: #ccc; margin-bottom: 10px;">Are you sure you want to delete BGP profile:</p>
                <p style="color: #76b900; font-size: 18px; font-weight: bold;" id="delete-bgp-name"></p>
                <p style="color: #888; font-size: 12px; margin-top: 10px;">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteBgpProfileModal()">Cancel</button>
                <button class="btn" style="background: #c53030; color: white;" onclick="confirmDeleteBgpProfile()">Delete</button>
            </div>
        </div>
    </div>
    
    <!-- View BGP Profile Modal -->
    <div class="modal" id="view-bgp-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="view-bgp-title">BGP Profile Details</h3>
                <button class="modal-close" onclick="closeViewBgpProfileModal()">×</button>
            </div>
            <div class="modal-body" id="view-bgp-content" style="max-height: 60vh; overflow: auto;">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewBgpProfileModal()">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Create VRF Modal -->
    <div class="modal" id="create-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create VRF</h3>
                <button class="modal-close" onclick="closeCreateModal()">×</button>
            </div>
            <div class="modal-body">
                <p style="color: #888; margin-bottom: 15px;">
                    VRFs are created per-device. To create a new VRF, go to 
                    <a href="fabric-config.html" style="color: #76b900;">Fabric Config</a>, 
                    select a device, and use the Create button in the VRFs section.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreateModal()">Close</button>
                <a href="fabric-config.html" class="btn btn-primary">Go to Fabric Config</a>
            </div>
        </div>
    </div>
    
    <!-- Delete VRF Modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3 style="color: #ff6b6b;">Delete VRF</h3>
                <button class="modal-close" onclick="closeDeleteModal()">×</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="#ff6b6b" style="margin-bottom: 15px;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
                <p style="color: #ccc; margin-bottom: 10px;">Are you sure you want to delete VRF:</p>
                <p style="color: #ce93d8; font-weight: bold; font-size: 18px; margin-bottom: 15px;" id="delete-vrf-name"></p>
                <div id="affected-devices-list" style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 6px;"></div>
            </div>
            <div class="modal-footer" style="justify-content: center; gap: 15px;">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn" id="btn-confirm-delete" onclick="confirmDelete()" style="background: #dc3545; color: white;">Delete</button>
            </div>
        </div>
    </div>
    
    <script>
        // State
        let vrfData = {};
        let bgpProfiles = {};
        let totalDeviceCount = 0;
        let infraVrfList = ['default'];  // Will be loaded from config
        let deletingBgpProfile = null;
        
        // Dynamic VRF badge colors - uses hash for consistent colors
        function getVrfBadgeClass(vrfName) {
            if (!vrfName || vrfName === 'L2 Only' || vrfName === 'default') return 'badge-gray';
            
            // Infra VRFs get blue
            if (vrfName === 'oob' || vrfName.toLowerCase().includes('mgmt') || vrfName.toLowerCase().includes('management')) {
                return 'badge-blue';
            }
            
            // Hash the VRF name to get consistent color
            const colors = ['badge-green', 'badge-purple', 'badge-orange', 'badge-cyan', 'badge-pink'];
            let hash = 0;
            for (let i = 0; i < vrfName.length; i++) {
                hash = ((hash << 5) - hash) + vrfName.charCodeAt(i);
                hash = hash & hash;
            }
            return colors[Math.abs(hash) % colors.length];
        }
        
        // Initialize
        async function init() {
            const isAuth = await LLDPqAuth.check();
            if (!isAuth) return;
            
            if (!LLDPqAuth.isAdmin()) {
                document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; color: #888;">Access denied. Admin only.</div>';
                return;
            }
            await loadData();
        }
        
        // Load all data
        async function loadData() {
            document.getElementById('content-area').innerHTML = '<div class="loading"><div class="spinner"></div>Loading VRF data...</div>';
            
            try {
                // Load infra_vrfs config and BGP profiles
                try {
                    const configResp = await fetch('/fabric-api.sh?action=get-bgp-profiles');
                    const configData = await configResp.json();
                    if (configData.success) {
                        if (configData.infra_vrfs) {
                            infraVrfList = configData.infra_vrfs;
                        }
                        if (configData.bgp_profiles) {
                            bgpProfiles = configData.bgp_profiles;
                            renderBgpProfilesTable();
                        }
                    }
                } catch (e) {
                    // Use default if config fails
                    infraVrfList = ['default'];
                    bgpProfiles = {};
                }
                
                const response = await fetch('/fabric-api.sh?action=get-vrf-report');
                const data = await response.json();
                
                if (data.success) {
                    vrfData = data.vrfs || {};
                    totalDeviceCount = data.device_count || 0;
                    
                    document.getElementById('last-updated').textContent = 'Last Updated: ' + new Date().toLocaleString();
                    updateSummary();
                    renderTable();
                } else {
                    document.getElementById('content-area').innerHTML = '<div class="no-data">Failed to load data: ' + (data.error || 'Unknown error') + '</div>';
                }
            } catch (e) {
                document.getElementById('content-area').innerHTML = '<div class="no-data">Failed to load data: ' + e.message + '</div>';
            }
        }
        
        // Update summary cards
        function updateSummary() {
            const vrfNames = Object.keys(vrfData);
            const totalVrfs = vrfNames.length;
            
            // Infra VRFs (from config: infraVrfList)
            const infraVrfs = vrfNames.filter(v => infraVrfList.includes(v));
            const infraCount = infraVrfs.length;
            
            // Tenant VRFs (everything else)
            const tenantVrfs = vrfNames.filter(v => !infraVrfList.includes(v));
            const tenantCount = tenantVrfs.length;
            
            document.getElementById('total-vrfs').textContent = totalVrfs;
            document.getElementById('total-devices').textContent = totalDeviceCount;
            document.getElementById('infra-vrfs').textContent = infraCount;
            document.getElementById('tenant-vrfs').textContent = tenantCount;
            
            // Update tooltips
            document.getElementById('infra-tooltip').innerHTML = infraCount > 0 
                ? `<ul>${infraVrfs.map(v => `<li>${v}</li>`).join('')}</ul>`
                : '<div style="color: #888; font-size: 12px;">No infra VRFs</div>';
            
            document.getElementById('tenant-tooltip').innerHTML = tenantCount > 0
                ? `<ul>${tenantVrfs.map(v => `<li>${v}</li>`).join('')}</ul>`
                : '<div style="color: #888; font-size: 12px;">No tenant VRFs</div>';
        }
        
        // Render table
        function renderTable() {
            const vrfNames = Object.keys(vrfData);
            
            if (vrfNames.length === 0) {
                document.getElementById('content-area').innerHTML = '<div class="no-data">No VRF profiles found.</div>';
                return;
            }
            
            // Sort by name, but "default" always first
            vrfNames.sort((a, b) => {
                if (a === 'default') return -1;
                if (b === 'default') return 1;
                return a.localeCompare(b);
            });
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 30px;"></th>
                            <th>VRF Name</th>
                            <th>L3VNI</th>
                            <th>VXLAN Int</th>
                            <th>Devices</th>
                            <th style="text-align: right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const vrfName of vrfNames) {
                const vrf = vrfData[vrfName];
                const devices = vrf.devices || [];
                const deviceCount = devices.length;
                
                const vxlanInt = vrf.vxlan_int ? `vlan${vrf.vxlan_int}_l3` : '-';
                
                html += `
                    <tr class="expandable" onclick="toggleDeviceList('${vrfName}')">
                        <td><span class="expand-icon" id="icon-${vrfName}">›</span></td>
                        <td><span class="badge ${getVrfBadgeClass(vrfName)}">${vrfName}</span></td>
                        <td>${vrf.l3vni || '-'}</td>
                        <td>${vxlanInt !== '-' ? `<span class="badge badge-gray">${vxlanInt}</span>` : '-'}</td>
                        <td>
                            <span class="badge ${deviceCount > 0 ? 'badge-green' : 'badge-gray'}">
                                ${deviceCount} device${deviceCount !== 1 ? 's' : ''}
                            </span>
                        </td>
                        <td>
                            <div class="row-actions" style="display: flex; gap: 8px;">
                                <button class="btn-icon" onclick="event.stopPropagation(); openAssignVrfToDevices('${vrfName}')" title="Assign to Devices" style="background: #2196f3; color: white;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                    </svg>
                                </button>
                                <button class="btn-icon btn-icon-delete" onclick="event.stopPropagation(); confirmDeleteVrf('${vrfName}')" title="Delete" ${vrfName === 'default' ? 'disabled style="opacity:0.3;cursor:not-allowed;"' : ''}>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="device-list-row" id="devices-${vrfName}">
                        <td colspan="6">
                            ${devices.length > 0 ? `
                                <div class="device-chips">
                                    ${devices.map(d => `<span class="device-chip">${d}<button class="remove-btn" onclick="event.stopPropagation(); confirmRemoveFromDevice('${vrfName}', '${d}')" title="Remove from ${d}">×</button></span>`).join('')}
                                </div>
                            ` : '<span style="color: #888;">No devices assigned</span>'}
                        </td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            document.getElementById('content-area').innerHTML = html;
        }
        
        // Toggle device list
        function toggleDeviceList(vrfName) {
            const row = document.getElementById('devices-' + vrfName);
            const icon = document.getElementById('icon-' + vrfName);
            
            if (row.classList.contains('visible')) {
                row.classList.remove('visible');
                icon.classList.remove('rotated');
            } else {
                row.classList.add('visible');
                icon.classList.add('rotated');
            }
        }
        
        // Modal functions
        function openCreateModal() {
            document.getElementById('create-modal').classList.add('visible');
        }
        
        function closeCreateModal() {
            document.getElementById('create-modal').classList.remove('visible');
        }
        
        // Delete VRF
        let deletingVrfName = '';
        
        function confirmDeleteVrf(vrfName) {
            if (vrfName === 'default') {
                alert('Cannot delete the default VRF');
                return;
            }
            
            deletingVrfName = vrfName;
            document.getElementById('delete-vrf-name').textContent = vrfName;
            
            const devices = vrfData[vrfName]?.devices || [];
            const affectedDiv = document.getElementById('affected-devices-list');
            if (devices.length > 0) {
                affectedDiv.innerHTML = `
                    <p style="color: #ff6b6b; margin-bottom: 8px;">Warning: This VRF is used by ${devices.length} device(s):</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
                        ${devices.map(d => `<span style="background: #444; padding: 2px 8px; border-radius: 4px; font-size: 12px;">${d}</span>`).join('')}
                    </div>
                `;
            } else {
                affectedDiv.innerHTML = '<p style="color: #888;">This VRF is not used by any devices.</p>';
            }
            
            document.getElementById('delete-modal').classList.add('visible');
        }
        
        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('visible');
            deletingVrfName = '';
        }
        
        async function confirmDelete() {
            if (!deletingVrfName) return;
            
            const vrfName = deletingVrfName;
            closeDeleteModal();
            
            try {
                const response = await fetch('/fabric-api.sh?action=delete-vrf-global', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vrf_name: vrfName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const devices = result.devices_updated || [];
                    let msg = `VRF "${vrfName}" deleted successfully!\n\n`;
                    msg += `Removed from ${devices.length} device(s)`;
                    if (result.leaking_removed) {
                        msg += '\nLeaking references also cleaned up.';
                    }
                    alert(msg);
                    loadData();
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
        
        // ===== Create VRF Modal =====
        async function openCreateVrfModal() {
            document.getElementById('create-vrf-form').reset();
            document.getElementById('create-leaking-options').style.display = 'none';
            document.getElementById('create-profile-group').style.display = 'block';
            
            // Load BGP profiles
            const profileSelect = document.getElementById('create-bgp-profile');
            profileSelect.innerHTML = '<option value="">Loading...</option>';
            try {
                const resp = await fetch('/fabric-api.sh?action=get-bgp-profiles');
                const data = await resp.json();
                if (data.success && data.profiles.length > 0) {
                    profileSelect.innerHTML = data.profiles.map(p => 
                        `<option value="${p.name}" ${p.name === 'OVERLAY_LEAF' ? 'selected' : ''}>${p.name}</option>`
                    ).join('');
                } else {
                    profileSelect.innerHTML = '<option value="OVERLAY_LEAF">OVERLAY_LEAF</option>';
                }
            } catch (e) {
                profileSelect.innerHTML = '<option value="OVERLAY_LEAF">OVERLAY_LEAF</option>';
            }
            
            // Load devices
            await loadCreateDeviceList();
            
            document.getElementById('create-vrf-modal').classList.add('visible');
        }
        
        async function loadCreateDeviceList() {
            const container = document.getElementById('create-device-list');
            container.innerHTML = '<div style="color: #888; font-size: 12px;">Loading...</div>';
            
            try {
                const response = await fetch('/fabric-api.sh?action=list-devices');
                const data = await response.json();
                
                if (data.success && data.devices) {
                    let html = '';
                    for (const [group, devices] of Object.entries(data.devices)) {
                        const groupId = group.replace(/[^a-zA-Z0-9]/g, '_');
                        html += `<div style="display: flex; align-items: center; gap: 6px; color: #76b900; font-size: 11px; padding: 5px 0 3px 0; border-bottom: 1px solid #333; cursor: pointer;" onclick="toggleGroupDevices('${groupId}', 'create-vrf-devices')">
                            <input type="checkbox" id="group-${groupId}" style="width: 12px; height: 12px;" onclick="event.stopPropagation(); toggleGroupDevices('${groupId}', 'create-vrf-devices')">
                            <span>${group}</span>
                        </div>`;
                        devices.forEach(device => {
                            const hostname = device.hostname || device;
                            html += `<label style="display: flex; align-items: center; gap: 6px; padding: 4px 8px 4px 20px; cursor: pointer; font-size: 12px; color: #ccc;">
                                <input type="checkbox" name="create-vrf-devices" data-group="${groupId}" value="${hostname}" style="width: 14px; height: 14px;" onchange="updateGroupCheckbox('${groupId}', 'create-vrf-devices')">
                                ${hostname}
                            </label>`;
                        });
                    }
                    container.innerHTML = html;
                }
            } catch (e) {
                container.innerHTML = '<div style="color: #f44336; font-size: 12px;">Error</div>';
            }
        }
        
        function toggleGroupDevices(groupId, inputName) {
            const groupCb = document.getElementById('group-' + groupId);
            const devices = document.querySelectorAll(`input[name="${inputName}"][data-group="${groupId}"]`);
            devices.forEach(cb => cb.checked = groupCb.checked);
        }
        
        function updateGroupCheckbox(groupId, inputName) {
            const devices = document.querySelectorAll(`input[name="${inputName}"][data-group="${groupId}"]`);
            const allChecked = Array.from(devices).every(cb => cb.checked);
            const groupCb = document.getElementById('group-' + groupId);
            if (groupCb) groupCb.checked = allChecked;
        }
        
        function selectAllCreateDevices(all) {
            document.querySelectorAll('input[name="create-vrf-devices"]').forEach(cb => cb.checked = all);
            document.querySelectorAll('input[id^="group-"]').forEach(cb => cb.checked = all);
        }
        
        function closeCreateVrfModal() {
            document.getElementById('create-vrf-modal').classList.remove('visible');
        }
        
        async function toggleCreateLeaking() {
            const checkbox = document.getElementById('create-leaking-enabled');
            const optionsDiv = document.getElementById('create-leaking-options');
            const profileGroup = document.getElementById('create-profile-group');
            
            if (checkbox.checked) {
                optionsDiv.style.display = 'block';
                profileGroup.style.display = 'none';
                
                const leakSelect = document.getElementById('create-leak-from');
                leakSelect.innerHTML = '<option value="">Loading...</option>';
                try {
                    const resp = await fetch('/fabric-api.sh?action=get-leaking-vrfs');
                    const data = await resp.json();
                    if (data.success && data.vrfs.length > 0) {
                        leakSelect.innerHTML = '<option value="">Select VRF...</option>' + 
                            data.vrfs.map(v => `<option value="${v.name}">${v.name}</option>`).join('');
                    } else {
                        leakSelect.innerHTML = '<option value="">No leaking VRFs found</option>';
                    }
                } catch (e) {
                    leakSelect.innerHTML = '<option value="">Error loading</option>';
                }
            } else {
                optionsDiv.style.display = 'none';
                profileGroup.style.display = 'block';
            }
        }
        
        async function createVrf() {
            const vrfName = document.getElementById('create-vrf-name').value.trim();
            const l3vni = parseInt(document.getElementById('create-l3vni').value);
            const vxlanInt = parseInt(document.getElementById('create-vxlan-int').value) || null;
            const leakingEnabled = document.getElementById('create-leaking-enabled').checked;
            const leakFromVrf = document.getElementById('create-leak-from').value;
            const bgpProfile = document.getElementById('create-bgp-profile').value;
            
            const selectedDevices = Array.from(document.querySelectorAll('input[name="create-vrf-devices"]:checked')).map(cb => cb.value);
            
            if (!vrfName) { alert('VRF name is required'); return; }
            if (!l3vni) { alert('L3VNI is required'); return; }
            if (selectedDevices.length === 0) { alert('Please select at least one device'); return; }
            if (leakingEnabled && !leakFromVrf) { alert('Please select a VRF to leak from'); return; }
            
            const btn = document.querySelector('#create-vrf-modal .btn-create');
            btn.disabled = true;
            btn.textContent = `Creating on ${selectedDevices.length} device(s)...`;
            
            try {
                const response = await fetch('/fabric-api.sh?action=create-vrf-bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        devices: selectedDevices,
                        vrf_name: vrfName,
                        l3vni: l3vni,
                        vxlan_int: vxlanInt,
                        bgp_profile: leakingEnabled ? null : bgpProfile,
                        leaking_enabled: leakingEnabled,
                        leak_from_vrf: leakingEnabled ? leakFromVrf : null
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    closeCreateVrfModal();
                    let msg = `VRF "${vrfName}" created on ${result.devices_created} device(s)!`;
                    if (result.leaking_configured) {
                        msg += `\n\nRoute leaking configured with ${result.shared_profile}`;
                    }
                    alert(msg);
                    loadData();
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
            
            btn.disabled = false;
            btn.textContent = 'Create VRF';
        }
        
        // ===== Assign VRF to Devices Modal =====
        let assigningVrfName = '';
        
        async function openAssignVrfToDevices(vrfName) {
            assigningVrfName = vrfName;
            document.getElementById('assign-vrf-title').textContent = `Assign "${vrfName}" to Devices`;
            
            const container = document.getElementById('assign-device-list');
            container.innerHTML = '<div style="color: #888; text-align: center;">Loading...</div>';
            document.getElementById('assign-vrf-modal').classList.add('visible');
            
            // Get current devices that have this VRF
            const currentDevices = vrfData[vrfName]?.devices || [];
            
            try {
                const response = await fetch('/fabric-api.sh?action=list-devices');
                const data = await response.json();
                
                if (data.success && data.devices) {
                    let html = '';
                    for (const [group, devices] of Object.entries(data.devices)) {
                        html += `<div style="color: #76b900; font-size: 11px; padding: 5px 0 3px 0; border-bottom: 1px solid #333;">${group}</div>`;
                        devices.forEach(device => {
                            const hostname = device.hostname || device;
                            const hasVrf = currentDevices.includes(hostname);
                            html += `<label style="display: flex; align-items: center; gap: 6px; padding: 4px 8px; cursor: pointer; font-size: 12px; color: ${hasVrf ? '#76b900' : '#ccc'};">
                                <input type="checkbox" name="assign-vrf-devices" value="${hostname}" ${hasVrf ? 'checked' : ''} style="width: 14px; height: 14px;">
                                ${hostname} ${hasVrf ? '✓' : ''}
                            </label>`;
                        });
                    }
                    container.innerHTML = html;
                }
            } catch (e) {
                container.innerHTML = '<div style="color: #f44336;">Error loading devices</div>';
            }
        }
        
        function selectAllAssignDevices(all) {
            document.querySelectorAll('input[name="assign-vrf-devices"]').forEach(cb => cb.checked = all);
        }
        
        function closeAssignVrfModal() {
            document.getElementById('assign-vrf-modal').classList.remove('visible');
            assigningVrfName = '';
        }
        
        async function assignVrfToDevices() {
            if (!assigningVrfName) return;
            
            const selectedDevices = Array.from(document.querySelectorAll('input[name="assign-vrf-devices"]:checked')).map(cb => cb.value);
            const currentDevices = vrfData[assigningVrfName]?.devices || [];
            
            // Find devices to add (newly checked)
            const toAdd = selectedDevices.filter(d => !currentDevices.includes(d));
            // Find devices to remove (unchecked that were previously checked)
            const toRemove = currentDevices.filter(d => !selectedDevices.includes(d));
            
            if (toAdd.length === 0 && toRemove.length === 0) {
                alert('No changes made');
                return;
            }
            
            const btn = document.querySelector('#assign-vrf-modal .btn-create');
            btn.disabled = true;
            btn.textContent = 'Applying...';
            
            let errors = [];
            
            // Add VRF to new devices
            for (const device of toAdd) {
                try {
                    const resp = await fetch('/fabric-api.sh?action=assign-vrfs', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ device: device, vrfs: [assigningVrfName] })
                    });
                    const result = await resp.json();
                    if (!result.success) errors.push(`Add ${device}: ${result.error}`);
                } catch (e) {
                    errors.push(`Add ${device}: ${e.message}`);
                }
            }
            
            // Remove VRF from unchecked devices
            for (const device of toRemove) {
                try {
                    const resp = await fetch('/fabric-api.sh?action=unassign-vrf', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ device: device, vrf: assigningVrfName })
                    });
                    const result = await resp.json();
                    if (!result.success) errors.push(`Remove ${device}: ${result.error}`);
                } catch (e) {
                    errors.push(`Remove ${device}: ${e.message}`);
                }
            }
            
            closeAssignVrfModal();
            
            if (errors.length > 0) {
                alert('Some operations failed:\n' + errors.join('\n'));
            } else {
                alert(`VRF "${assigningVrfName}" updated:\n+ Added to ${toAdd.length} device(s)\n- Removed from ${toRemove.length} device(s)`);
            }
            
            loadData();
            
            btn.disabled = false;
            btn.textContent = 'Apply Changes';
        }
        
        // ===== Remove VRF from Single Device =====
        let removeVrfName = '';
        let removeDeviceName = '';
        
        function confirmRemoveFromDevice(vrfName, deviceName) {
            removeVrfName = vrfName;
            removeDeviceName = deviceName;
            document.getElementById('remove-single-vrf-name').textContent = vrfName;
            document.getElementById('remove-single-device-name').textContent = deviceName;
            document.getElementById('remove-single-modal').classList.add('visible');
        }
        
        function closeRemoveSingleModal() {
            document.getElementById('remove-single-modal').classList.remove('visible');
            removeVrfName = '';
            removeDeviceName = '';
        }
        
        async function confirmRemoveSingle() {
            if (!removeVrfName || !removeDeviceName) return;
            
            const vrfName = removeVrfName;
            const deviceName = removeDeviceName;
            closeRemoveSingleModal();
            
            try {
                const response = await fetch('/fabric-api.sh?action=unassign-vrf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ device: deviceName, vrf: vrfName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    let msg = `VRF "${vrfName}" removed from ${deviceName}`;
                    if (result.leaking_removed) {
                        msg += '\nLeaking references also cleaned up.';
                    }
                    alert(msg);
                    loadData();
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
        
        // ===== BGP Profiles Functions =====
        
        function renderBgpProfilesTable() {
            const container = document.getElementById('bgp-profiles-content');
            const profiles = Object.entries(bgpProfiles);
            
            // Filter out UNDERLAY profiles (show only OVERLAY/BORDER profiles)
            const filteredProfiles = profiles.filter(([name, _]) => !name.includes('UNDERLAY'));
            
            if (filteredProfiles.length === 0) {
                container.innerHTML = '<div style="color: #888; padding: 20px; text-align: center;">No BGP profiles defined (UNDERLAY profiles are hidden).</div>';
                return;
            }
            
            // Sort profiles alphabetically
            filteredProfiles.sort((a, b) => a[0].localeCompare(b[0]));
            const profiles_to_render = filteredProfiles;
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Profile Name</th>
                            <th>Redistribute</th>
                            <th>EVPN Type-5</th>
                            <th>L2VPN EVPN</th>
                            <th>Peer Groups</th>
                            <th style="width: 120px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const [name, profile] of profiles_to_render) {
                const ipv4 = profile.ipv4_unicast_af || {};
                const l2vpn = profile.l2vpn_evpn_af || {};
                const peerGroups = profile.peer_groups || {};
                
                const redistConnected = ipv4.redistribute_connected_routes ? '✓ Connected' : '';
                const redistStatic = ipv4.redistribute_static_routes ? '✓ Static' : '';
                const redistText = [redistConnected, redistStatic].filter(Boolean).join(', ') || '-';
                
                const evpnType5 = ipv4.export_to_evpn_type5 ? '<span class="badge badge-green">Yes</span>' : '<span class="badge badge-gray">No</span>';
                const l2vpnEvpn = l2vpn.enable_evpn ? '<span class="badge badge-cyan">Yes</span>' : '<span class="badge badge-gray">No</span>';
                
                const pgCount = Object.keys(peerGroups).length;
                const pgNames = Object.keys(peerGroups).slice(0, 2).join(', ');
                const pgDisplay = pgCount > 0 ? `<span class="badge badge-purple">${pgCount}</span> ${pgNames}${pgCount > 2 ? '...' : ''}` : '-';
                
                html += `
                    <tr>
                        <td><strong style="color: #76b900;">${name}</strong></td>
                        <td style="font-size: 12px;">${redistText}</td>
                        <td>${evpnType5}</td>
                        <td>${l2vpnEvpn}</td>
                        <td>${pgDisplay}</td>
                        <td>
                            <div style="display: flex; gap: 4px;">
                                <button class="btn-icon" onclick="viewBgpProfile('${name}')" title="View Details" style="background: #404040; border: none; padding: 6px; border-radius: 4px; cursor: pointer;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="#ccc">
                                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                    </svg>
                                </button>
                                <button class="btn-icon btn-icon-edit" onclick="openEditBgpProfileModal('${name}')" title="Edit">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                    </svg>
                                </button>
                                <button class="btn-icon btn-icon-delete" onclick="openDeleteBgpProfileModal('${name}')" title="Delete">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function addPeerGroupEntry(containerId) {
            const container = document.getElementById(containerId);
            const entry = document.createElement('div');
            entry.className = 'peer-group-entry';
            entry.style.cssText = 'background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 10px;';
            entry.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                    <input type="text" class="pg-name" placeholder="Peer Group Name" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                    <select class="pg-type" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                        <option value="external">External</option>
                        <option value="internal">Internal</option>
                    </select>
                    <button type="button" onclick="this.closest('.peer-group-entry').remove()" style="background: #c53030; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">×</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                        <input type="checkbox" class="pg-bfd" checked style="width: 14px; height: 14px;">
                        Enable BFD
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                        <input type="checkbox" class="pg-evpn" style="width: 14px; height: 14px;">
                        Enable EVPN
                    </label>
                </div>
                <input type="text" class="pg-description" placeholder="Description (optional)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; margin-bottom: 10px;">
                <textarea class="pg-peers" placeholder="Peers (one per line: swp1, swp2 or 10.0.0.1, 10.0.0.2)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; min-height: 60px; font-family: monospace;"></textarea>
            `;
            container.appendChild(entry);
        }
        
        function getPeerGroupsFromContainer(containerId) {
            const container = document.getElementById(containerId);
            const entries = container.querySelectorAll('.peer-group-entry');
            const peerGroups = {};
            
            entries.forEach(entry => {
                const name = entry.querySelector('.pg-name').value.trim();
                if (!name) return;
                
                const peerType = entry.querySelector('.pg-type').value;
                const enableBfd = entry.querySelector('.pg-bfd').checked;
                const enableEvpn = entry.querySelector('.pg-evpn').checked;
                const description = entry.querySelector('.pg-description').value.trim();
                const peersText = entry.querySelector('.pg-peers').value.trim();
                
                const pg = {
                    peer_type: peerType,
                    enable_bfd: enableBfd
                };
                
                if (enableEvpn) pg.enable_evpn = true;
                if (description) pg.description = description;
                
                // Parse peers - could be interfaces (swpX) or IPs
                if (peersText) {
                    const peers = peersText.split('\n').map(p => p.trim()).filter(Boolean);
                    // Check if IPs (contains dots) or interfaces
                    const isIPs = peers.some(p => p.includes('.'));
                    if (isIPs) {
                        pg.peers = {};
                        peers.forEach(p => {
                            const ip = p.split(':')[0].trim();
                            pg.peers[ip] = {};
                        });
                    } else {
                        pg.peers = peers;
                    }
                }
                
                peerGroups[name] = pg;
            });
            
            return peerGroups;
        }
        
        function openCreateBgpProfileModal() {
            document.getElementById('create-bgp-form').reset();
            document.getElementById('bgp-redistribute-connected').checked = true;
            document.getElementById('bgp-peer-groups-container').innerHTML = `
                <div class="peer-group-entry" style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="pg-name" placeholder="Peer Group Name" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                        <select class="pg-type" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                            <option value="external">External</option>
                            <option value="internal">Internal</option>
                        </select>
                        <button type="button" onclick="this.closest('.peer-group-entry').remove()" style="background: #c53030; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">×</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                            <input type="checkbox" class="pg-bfd" checked style="width: 14px; height: 14px;">
                            Enable BFD
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                            <input type="checkbox" class="pg-evpn" style="width: 14px; height: 14px;">
                            Enable EVPN
                        </label>
                    </div>
                    <input type="text" class="pg-description" placeholder="Description (optional)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; margin-bottom: 10px;">
                    <textarea class="pg-peers" placeholder="Peers (one per line: swp1, swp2 or 10.0.0.1, 10.0.0.2)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; min-height: 60px; font-family: monospace;"></textarea>
                </div>
            `;
            document.getElementById('create-bgp-modal').classList.add('visible');
        }
        
        function closeCreateBgpProfileModal() {
            document.getElementById('create-bgp-modal').classList.remove('visible');
        }
        
        async function createBgpProfile() {
            const name = document.getElementById('bgp-profile-name').value.trim();
            if (!name) {
                alert('Profile name is required');
                return;
            }
            
            const data = {
                profile_name: name,
                redistribute_connected: document.getElementById('bgp-redistribute-connected').checked,
                redistribute_static: document.getElementById('bgp-redistribute-static').checked,
                export_to_evpn_type5: document.getElementById('bgp-export-evpn-type5').checked,
                enable_evpn: document.getElementById('bgp-enable-evpn').checked,
                peer_groups: getPeerGroupsFromContainer('bgp-peer-groups-container')
            };
            
            try {
                const response = await fetch('/fabric-api.sh?action=create-bgp-profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (result.success) {
                    closeCreateBgpProfileModal();
                    loadData();
                    alert('BGP profile created successfully!');
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
        
        function openEditBgpProfileModal(name) {
            const profile = bgpProfiles[name];
            if (!profile) return;
            
            document.getElementById('edit-bgp-original-name').value = name;
            document.getElementById('edit-bgp-profile-name').value = name;
            
            const ipv4 = profile.ipv4_unicast_af || {};
            const l2vpn = profile.l2vpn_evpn_af || {};
            
            document.getElementById('edit-bgp-redistribute-connected').checked = ipv4.redistribute_connected_routes !== false;
            document.getElementById('edit-bgp-redistribute-static').checked = ipv4.redistribute_static_routes === true;
            document.getElementById('edit-bgp-export-evpn-type5').checked = ipv4.export_to_evpn_type5 === true;
            document.getElementById('edit-bgp-enable-evpn').checked = l2vpn.enable_evpn === true;
            
            // Populate peer groups
            const container = document.getElementById('edit-bgp-peer-groups-container');
            container.innerHTML = '';
            
            const peerGroups = profile.peer_groups || {};
            for (const [pgName, pg] of Object.entries(peerGroups)) {
                const entry = document.createElement('div');
                entry.className = 'peer-group-entry';
                entry.style.cssText = 'background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 10px;';
                
                // Format peers
                let peersText = '';
                if (pg.peers) {
                    if (Array.isArray(pg.peers)) {
                        peersText = pg.peers.join('\n');
                    } else {
                        peersText = Object.keys(pg.peers).join('\n');
                    }
                }
                
                entry.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                        <input type="text" class="pg-name" value="${pgName}" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                        <select class="pg-type" style="padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff;">
                            <option value="external" ${pg.peer_type === 'external' ? 'selected' : ''}>External</option>
                            <option value="internal" ${pg.peer_type === 'internal' ? 'selected' : ''}>Internal</option>
                        </select>
                        <button type="button" onclick="this.closest('.peer-group-entry').remove()" style="background: #c53030; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">×</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                            <input type="checkbox" class="pg-bfd" ${pg.enable_bfd ? 'checked' : ''} style="width: 14px; height: 14px;">
                            Enable BFD
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; color: #ccc; font-size: 13px;">
                            <input type="checkbox" class="pg-evpn" ${pg.enable_evpn ? 'checked' : ''} style="width: 14px; height: 14px;">
                            Enable EVPN
                        </label>
                    </div>
                    <input type="text" class="pg-description" value="${pg.description || ''}" placeholder="Description (optional)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; margin-bottom: 10px;">
                    <textarea class="pg-peers" placeholder="Peers (one per line)" style="width: 100%; padding: 8px; background: #2d2d2d; border: 1px solid #404040; border-radius: 4px; color: #fff; min-height: 60px; font-family: monospace;">${peersText}</textarea>
                `;
                container.appendChild(entry);
            }
            
            document.getElementById('edit-bgp-modal').classList.add('visible');
        }
        
        function closeEditBgpProfileModal() {
            document.getElementById('edit-bgp-modal').classList.remove('visible');
        }
        
        async function saveBgpProfile() {
            const originalName = document.getElementById('edit-bgp-original-name').value;
            const name = document.getElementById('edit-bgp-profile-name').value.trim();
            
            if (!name) {
                alert('Profile name is required');
                return;
            }
            
            const data = {
                original_name: originalName,
                profile_name: name,
                redistribute_connected: document.getElementById('edit-bgp-redistribute-connected').checked,
                redistribute_static: document.getElementById('edit-bgp-redistribute-static').checked,
                export_to_evpn_type5: document.getElementById('edit-bgp-export-evpn-type5').checked,
                enable_evpn: document.getElementById('edit-bgp-enable-evpn').checked,
                peer_groups: getPeerGroupsFromContainer('edit-bgp-peer-groups-container')
            };
            
            try {
                const response = await fetch('/fabric-api.sh?action=update-bgp-profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (result.success) {
                    closeEditBgpProfileModal();
                    loadData();
                    alert('BGP profile updated successfully!');
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
        
        function openDeleteBgpProfileModal(name) {
            deletingBgpProfile = name;
            document.getElementById('delete-bgp-name').textContent = name;
            document.getElementById('delete-bgp-modal').classList.add('visible');
        }
        
        function closeDeleteBgpProfileModal() {
            document.getElementById('delete-bgp-modal').classList.remove('visible');
            deletingBgpProfile = null;
        }
        
        async function confirmDeleteBgpProfile() {
            if (!deletingBgpProfile) return;
            
            try {
                const response = await fetch('/fabric-api.sh?action=delete-bgp-profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ profile_name: deletingBgpProfile })
                });
                const result = await response.json();
                
                if (result.success) {
                    closeDeleteBgpProfileModal();
                    loadData();
                    alert('BGP profile deleted successfully!');
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }
        
        function viewBgpProfile(name) {
            const profile = bgpProfiles[name];
            if (!profile) return;
            
            document.getElementById('view-bgp-title').textContent = `BGP Profile: ${name}`;
            
            const ipv4 = profile.ipv4_unicast_af || {};
            const l2vpn = profile.l2vpn_evpn_af || {};
            const peerGroups = profile.peer_groups || {};
            
            let html = `
                <div style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; color: #76b900;">IPv4 Unicast Address Family</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>Redistribute Connected: <strong>${ipv4.redistribute_connected_routes ? 'Yes' : 'No'}</strong></div>
                        <div>Redistribute Static: <strong>${ipv4.redistribute_static_routes ? 'Yes' : 'No'}</strong></div>
                        <div>Export to EVPN Type-5: <strong>${ipv4.export_to_evpn_type5 ? 'Yes' : 'No'}</strong></div>
                    </div>
                </div>
            `;
            
            if (l2vpn.enable_evpn) {
                html += `
                    <div style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #4fc3f7;">L2VPN EVPN Address Family</h4>
                        <div>EVPN Enabled: <strong>Yes</strong></div>
                    </div>
                `;
            }
            
            if (Object.keys(peerGroups).length > 0) {
                html += `<h4 style="margin: 15px 0 10px 0; color: #ccc;">Peer Groups</h4>`;
                
                for (const [pgName, pg] of Object.entries(peerGroups)) {
                    let peersHtml = '';
                    if (pg.peers) {
                        if (Array.isArray(pg.peers)) {
                            peersHtml = pg.peers.map(p => `<span class="badge badge-gray" style="margin: 2px;">${p}</span>`).join('');
                        } else {
                            peersHtml = Object.keys(pg.peers).map(p => `<span class="badge badge-blue" style="margin: 2px;">${p}</span>`).join('');
                        }
                    }
                    
                    html += `
                        <div style="background: #1e1e1e; padding: 15px; border-radius: 4px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #76b900;">${pgName}</strong>
                                <span class="badge ${pg.peer_type === 'external' ? 'badge-orange' : 'badge-purple'}">${pg.peer_type || 'external'}</span>
                            </div>
                            ${pg.description ? `<div style="color: #888; font-size: 12px; margin-bottom: 10px;">${pg.description}</div>` : ''}
                            <div style="font-size: 12px; margin-bottom: 8px;">
                                BFD: <strong>${pg.enable_bfd ? 'Yes' : 'No'}</strong> | 
                                EVPN: <strong>${pg.enable_evpn ? 'Yes' : 'No'}</strong>
                            </div>
                            ${peersHtml ? `<div style="margin-top: 10px;"><strong style="color: #888; font-size: 12px;">Peers:</strong><div style="margin-top: 5px;">${peersHtml}</div></div>` : ''}
                        </div>
                    `;
                }
            }
            
            document.getElementById('view-bgp-content').innerHTML = html;
            document.getElementById('view-bgp-modal').classList.add('visible');
        }
        
        function closeViewBgpProfileModal() {
            document.getElementById('view-bgp-modal').classList.remove('visible');
        }
        
        // Init on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
    
    <!-- Remove VRF from Single Device Modal -->
    <div class="modal" id="remove-single-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Remove VRF from Device</h3>
                <button class="modal-close" onclick="closeRemoveSingleModal()">×</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 25px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="#ff9800" style="margin-bottom: 15px;">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
                <p style="color: #ccc; margin-bottom: 10px;">Remove VRF from this device?</p>
                <p style="color: #76b900; font-weight: bold; font-size: 16px;" id="remove-single-vrf-name"></p>
                <p style="color: #888; font-size: 13px; margin-top: 10px;">Device: <span id="remove-single-device-name" style="color: #4fc3f7;"></span></p>
            </div>
            <div class="modal-footer" style="justify-content: center; gap: 15px;">
                <button class="btn btn-secondary" onclick="closeRemoveSingleModal()">Cancel</button>
                <button class="btn" onclick="confirmRemoveSingle()" style="background: #ff9800; color: #fff;">Remove</button>
            </div>
        </div>
    </div>
    
    <!-- Create VRF Modal -->
    <div class="modal" id="create-vrf-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Create New VRF</h3>
                <button class="modal-close" onclick="closeCreateVrfModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="create-vrf-form" onsubmit="event.preventDefault(); createVrf();">
                    <div class="form-group">
                        <label>VRF Name *</label>
                        <input type="text" id="create-vrf-name" required placeholder="e.g., tenant1" style="width:100%; padding:10px; background:#1e1e1e; border:1px solid #404040; border-radius:4px; color:#fff;">
                    </div>
                    <div class="form-group">
                        <label>L3VNI *</label>
                        <input type="number" id="create-l3vni" required placeholder="e.g., 2001001" style="width:100%; padding:10px; background:#1e1e1e; border:1px solid #404040; border-radius:4px; color:#fff;">
                    </div>
                    <div class="form-group">
                        <label>VXLAN Interface VLAN</label>
                        <input type="number" id="create-vxlan-int" placeholder="e.g., 4063" style="width:100%; padding:10px; background:#1e1e1e; border:1px solid #404040; border-radius:4px; color:#fff;">
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="create-leaking-enabled" onchange="toggleCreateLeaking()" style="width:16px; height:16px;">
                            Enable Route Leaking
                        </label>
                    </div>
                    <div id="create-leaking-options" style="display:none; padding:12px; background:#252526; border-radius:6px; margin-bottom:15px;">
                        <label>Leak FROM VRF</label>
                        <select id="create-leak-from" style="width:100%; padding:10px; background:#1e1e1e; border:1px solid #404040; border-radius:4px; color:#fff;">
                            <option value="">Select VRF...</option>
                        </select>
                    </div>
                    <div class="form-group" id="create-profile-group">
                        <label>BGP Profile</label>
                        <select id="create-bgp-profile" style="width:100%; padding:10px; background:#1e1e1e; border:1px solid #404040; border-radius:4px; color:#fff;">
                            <option value="">Loading...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display:flex; justify-content:space-between;">
                            <span>Target Devices</span>
                            <span style="font-size:11px; color:#888;">
                                <a href="#" onclick="selectAllCreateDevices(true); return false;" style="color:#4fc3f7;">All</a> | 
                                <a href="#" onclick="selectAllCreateDevices(false); return false;" style="color:#4fc3f7;">None</a>
                            </span>
                        </label>
                        <div id="create-device-list" style="max-height:200px; overflow-y:auto; background:#1a1a1a; border:1px solid #404040; border-radius:4px; padding:8px;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreateVrfModal()">Cancel</button>
                <button class="btn btn-create" onclick="createVrf()" style="background:#76b900; color:#fff;">Create VRF</button>
            </div>
        </div>
    </div>
    
    <!-- Assign VRF to Devices Modal -->
    <div class="modal" id="assign-vrf-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3 id="assign-vrf-title">Assign VRF to Devices</h3>
                <button class="modal-close" onclick="closeAssignVrfModal()">×</button>
            </div>
            <div class="modal-body">
                <p style="color:#888; font-size:13px; margin-bottom:15px;">Check devices to assign this VRF, uncheck to remove.</p>
                <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                    <span style="font-size:11px; color:#888;">
                        <a href="#" onclick="selectAllAssignDevices(true); return false;" style="color:#4fc3f7;">All</a> | 
                        <a href="#" onclick="selectAllAssignDevices(false); return false;" style="color:#4fc3f7;">None</a>
                    </span>
                </div>
                <div id="assign-device-list" style="max-height:300px; overflow-y:auto; background:#1a1a1a; border:1px solid #404040; border-radius:4px; padding:8px;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAssignVrfModal()">Cancel</button>
                <button class="btn btn-create" onclick="assignVrfToDevices()" style="background:#2196f3; color:#fff;">Apply Changes</button>
            </div>
        </div>
    </div>
</body>
</html>
